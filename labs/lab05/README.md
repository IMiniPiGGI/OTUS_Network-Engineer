# Лабораторная работа. Доступ к сетевым устройствам по протоколу SSH

# Топология

![](https://github.com/IMiniPiGGI/OTUS_Network-Engineer/blob/Basic-Homework/labs/lab05/pics/pic%20base.png)

# Таблица адресации

| Устройство | Интерфейс | IP-адрес | Маска подсети | Шлюз по умолчанию |
| --- | --- | --- | --- | --- |
| R1  | G0/0/1 | 192.168.1.1 | 255.255.255.0 | —   |
| S1  | VLAN 1 | 192.168.1.11 | 255.255.255.0 | 192.168.1.1 |
| PC-A | NIC | 192.168.1.3 | 255.255.255.0 | 192.168.1.1 |

# Задачи

Часть 1. Настройка основных параметров устройства

Часть 2. Настройка маршрутизатора для доступа по протоколу SSH

Часть 3. Настройка коммутатора для доступа по протоколу SSH

Часть 4. SSH через интерфейс командной строки (CLI) коммутатора

# Решение

## Настройка основных параметров устройств

### Шаг 1. Создаю сеть согласно топологии

![](https://github.com/IMiniPiGGI/OTUS_Network-Engineer/blob/Basic-Homework/labs/lab05/pics/pic%201.png)

### Шаг 2. Выполняю инициализацию и перезагрузку маршрутизатора и коммутатора

### Шаг 3. Настраиваю маршрутизатор

1. Подключаюсь к маршрутизатору с помощью консоли и активирую привилегированный режим EXEC.
2. Вхожу в режим конфигурации.
3. Отключаю поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
4. Назначаю class в качестве зашифрованного пароля привилегированного режима EXEC.
5. Назначаю cisco в качестве пароля консоли и включаю вход в систему по паролю.
6. Назначаю cisco в качестве пароля VTY и включаю вход в систему по паролю.
7. Шифрую открытые пароли.
8. Создаю баннер, который предупреждает о запрете несанкционированного доступа.
9. Настраиваю и активирую на маршрутизаторе интерфейс G0/0/1, используя информацию, приведенную в таблице адресации.
10. Сохраняю текущую конфигурацию в файл загрузочной конфигурации.
```
enable
conf t
no ip domain-lookup
enable secret class
line con 0
password cisco
logging synchronous
line vty 0 4
password cisco
exit
service password-encryption
banner login #UNAUTHORIZED ACCESS TO THIS DEVICE IS PROHIBITED#
int gi 0/0/1
ip addr 192.168.1.1 255.255.255.0
no sh
do wr
```
### Шаг 4. Настраиваю компьютер PC-A

Настраиваю для PC-A IP-адрес и маску подсети.

Настраиваю для PC-A шлюз по умолчанию.

![](https://github.com/IMiniPiGGI/OTUS_Network-Engineer/blob/Basic-Homework/labs/lab05/pics/pic%202.png)

### Шаг 5. Проверяю подключение к сети

Отправляю с PC-A команду Ping на маршрутизатор R1.
```
C:\>ping 192.168.1.1

Pinging 192.168.1.1 with 32 bytes of data:

Reply from 192.168.1.1: bytes=32 time<1ms TTL=255
Reply from 192.168.1.1: bytes=32 time=1ms TTL=255
Reply from 192.168.1.1: bytes=32 time<1ms TTL=255
Reply from 192.168.1.1: bytes=32 time=1ms TTL=255

Ping statistics for 192.168.1.1:
Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
Minimum = 0ms, Maximum = 1ms, Average = 0ms
```
## Часть 2. Настройка маршрутизатора для доступа по протоколу SSH

### Шаг 1. Настраиваю аутентификацию устройств

При генерации ключа шифрования в качестве его части используются имя устройства и домен. Поэтому эти имена необходимо указать перед вводом команды crypto key.

1. Задаю имя устройства.
2. Задаю домен для устройства.
```
hostname R1
ip domain name myOTUSdomain.ru
```
### Шаг 2. Создаю ключ шифрования с указанием его длины
```
R1(config)#crypto key generate rsa general-keys modulus 2048

The name for the keys will be: R1.myOTUSdomain.ru

% The key modulus size is 2048 bits
% Generating 2048 bit RSA keys, keys will be non-exportable...\[OK\]
*Mar 1 0:19:48.535: %SSH-5-ENABLED: SSH 1.99 has been enabled
```
### Шаг 3. Создаю имя пользователя в локальной базе учетных записей

Настраиваю имя пользователя, используя admin в качестве имени пользователя и Adm1nP@55 в качестве пароля.
```
username admin privilege 15 secret Adm1nP@55
```
### Шаг 4. Активирую протокол SSH на линиях VTY

1. Активирую протоколы Telnet и SSH на входящих линиях VTY с помощью команды transport input.
2. Изменяю способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.
```
line vty 0 4
transport input ssh
login local
```
### Шаг 5. Сохраняю текущую конфигурацию в файл загрузочной конфигурации
```
R1(config-line)#do wr
Building configuration...
[OK]
```
### Шаг 6. Устанавливаю соединение с маршрутизатором по протоколу SSH

1. Запускаю эмулятор ssh с PC-A.
2. Устанавливаю SSH-подключение к R1, используя логин admin и пароль Adm1nP@55.

![](https://github.com/IMiniPiGGI/OTUS_Network-Engineer/blob/Basic-Homework/labs/lab05/pics/pic%203.png)

## Часть 3. Настройка коммутатора для доступа по протоколу SSH

### Шаг 1. Настраиваю основные параметры коммутатора

1. Подключаюсь к коммутатору с помощью консольного подключения и активирую привилегированный режим EXEC.
2. Вхожу в режим конфигурации.
3. Отключаю поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.
4. Назначаю class в качестве зашифрованного пароля привилегированного режима EXEC.
5. Назначаю cisco в качестве пароля консоли и включите вход в систему по паролю.
6. Назначаю cisco в качестве пароля VTY и включите вход в систему по паролю.
7. Шифрую открытые пароли.
8. Создаю баннер, который предупреждает о запрете несанкционированного доступа.
9. Настраиваю и активирую на коммутаторе интерфейс VLAN 1, используя информацию, приведенную в таблице адресации.
10. Сохраняю текущую конфигурацию в файл загрузочной конфигурации.
```
enable
conf t
no ip domain-lookup
enable secret class
line con 0
password cisco
line vty 0 4
password cisco
service password-encryption
banner motd #UNAUTHORIZED ACCESS TO THIS DEVICE IS PROHIBITED#
int vlan 1
ip addr 192.168.1.11 255.255.255.0
no shutdown
exit
ip default-gateway 192.168.1.1
end
wr
```
### Шаг 2. Настраиваю коммутатор для соединения по протоколу SSH

Для настройки протокола SSH на коммутаторе использую те же команды, которые применялись для аналогичной настройки маршрутизатора в части 2.

1. Настраиваю имя устройства, как указано в таблице адресации.
2. Задаю домен для устройства.
3. Создаю ключ шифрования с указанием его длины.
4. Создаю имя пользователя в локальной базе учетных записей.
5. Активирую протоколы Telnet и SSH на линиях VTY.
6. Изменяю способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.
```
conf t
hostname S1
ip domain-name myOTUSdomain.ru
crypto key generate rsa general-keys modulus 2048
username Admin privilege 15 secret Adm1nP@55
transport input ssh
login local
```
### Шаг 3. Устанавиливаю соединение с коммутатором по протоколу SSH

Запускаю эмулятор ssh на PC-A, затем устанавливаю подключение по протоколу SSH к интерфейсу SVI коммутатора S1.

Вопрос: Удалось ли вам установить SSH-соединение с коммутатором?

Ответ: Да

Часть 4. Настройка протокола SSH с использованием интерфейса командной строки **(CLI) коммутатора**

### Шаг 1. Смотрю доступные параметры для клиента SSH в Cisco IOS

Использую вопросительный знак (?), чтобы отобразить варианты параметров для команды ssh.
```
S1# ssh?
-c Select encryption algorithm
-l Log in using this user name
-m Select HMAC algorithm
-o Specify options
-p Connect to this port
-v Specify SSH Protocol Version
-vrf Specify vrf name
WORD IP-адрес или имя хоста удаленной системы
```
Шаг 2. Устанавливаю с коммутатора S1 соединение с маршрутизатором R1 по протоколу SSH.

1. Чтобы подключиться к маршрутизатору R1 по протоколу SSH, ввожу команду –l admin. Это позволяет мне войти в систему под именем admin. При появлении приглашения ввожу в качестве пароля Adm1nP@55
```
S1# ssh -l admin 192.168.1.1
Password:
UNAUTHORIZED ACCESS TO THIS DEVICE IS PROHIBITED
R1>
```
1. Чтобы вернуться к коммутатору S1, не закрывая сеанс SSH с маршрутизатором R1, нажимаю комбинацию клавиш Ctrl+Shift+6. Отпускаю клавиши Ctrl+Shift+6 и нажимаю x. Отображается приглашение привилегированного режима EXEC коммутатора.
```
R1>
S1#
```
1. Чтобы вернуться к сеансу SSH на R1, нажимаю клавишу Enter в пустой строке интерфейса командной строки. Чтобы увидеть окно командной строки маршрутизатора, нажимаю клавишу Enter еще раз.
```
S1#
[Resuming connection 1 to 192.168.1.1 ... ]
R1>
```
1. Чтобы завершить сеанс SSH на маршрутизаторе R1, ввожу в командной строке маршрутизатора команду exit.
```
R1# exit  
[Connection to 192.168.1.1 closed by foreign host]
S1#
```
Вопрос: Какие версии протокола SSH поддерживаются при использовании интерфейса командной строки?

Ответ: SSH 1 и SSH 2

# Вопрос для повторения

Вопрос: Как предоставить доступ к сетевому устройству нескольким пользователям, у каждого из которых есть собственное имя пользователя?

Ответ: Нужно создать новых пользователей на устройстве (к примеру, username USER1 password PASS1!) после чего в настройках линии vty передать параметр login local
